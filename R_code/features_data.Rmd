---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(tidyverse)
library(survival)
library(survminer)
library(cmprsk)
library(tidyverse)
library(caret)
library(survival)
library(survminer)
library(lubridate)
```


```{r}
features = read_tsv("/Users/noa/Workspace/raxml_deep_learning_results/ready_raw_data/Pandit/ML/ML_edited_features.tsv")
```
```{r}
all_features<- read_tsv("/Users/noa/Workspace/raxml_deep_learning_results/ready_raw_data/Pandit/ML/all_features.tsv")
```
```{r}
all_features
```



```{r}
all_features %>% distinct (feature_msa_pypythia_msa_difficulty, feature_mds_False_stress_20) %>% ggplot(aes(x=feature_msa_pypythia_msa_difficulty, y=feature_mds_False_stress_20))+geom_point()

all_features %>% distinct (feature_msa_pypythia_msa_difficulty, feature_mds_False_stress_3) %>% ggplot(aes(x=feature_msa_pypythia_msa_difficulty, y=feature_mds_False_stress_3))+geom_point()

```
Parsimony vs. Random

```{r}
features %>% group_by(msa_path,starting_tree_ind,starting_tree_type) %>% summarise(is_global_max = mean(is_global_max)) %>% ggplot(aes(x= is_global_max, color =starting_tree_type))+geom_histogram()


features %>% group_by(msa_path,starting_tree_ind,starting_tree_type) %>% summarise(mean_delta_ll = mean(delta_ll_from_overall_msa_best_topology)) %>% ggplot(aes(x= mean_delta_ll, fill =starting_tree_type))+geom_histogram()


```
```{r}
features %>% filter (starting_tree_type=='pars') %>% select (feature_mds_False_pca_0_3,feature_mds_False_pca_1_3,feature_mds_False_pca_2_3, delta_ll_from_overall_msa_best_topology, is_global_max) %>% ggplot(aes( x =feature_mds_False_pca_0_3,color=as.factor(is_global_max), ))+geom_density()

features %>% filter (starting_tree_type=='pars') %>% select (feature_mds_False_pca_0_3,feature_mds_False_pca_1_3,feature_mds_False_pca_2_3, delta_ll_from_overall_msa_best_topology, is_global_max) %>% ggplot(aes( x =feature_mds_False_pca_1_3,y = delta_ll_from_overall_msa_best_topology ))+geom_point()

features %>% filter (starting_tree_type=='pars') %>% select (feature_mds_False_pca_0_3,feature_mds_False_pca_1_3,feature_mds_False_pca_2_3, delta_ll_from_overall_msa_best_topology, is_global_max) %>% ggplot(aes( x =feature_mds_False_pca_1_3,y = delta_ll_from_overall_msa_best_topology ))+geom_point()


```



```{r}
features %>% filter (starting_tree_type=='rand') %>% select (feature_mds_False_pca_0_3,feature_mds_False_pca_1_3,feature_mds_False_pca_2_3, delta_ll_from_overall_msa_best_topology, is_global_max) %>% ggplot(aes( x =feature_mds_False_pca_0_3,color=as.factor(is_global_max), ))+geom_density()


```




```{r}
data = features %>% filter (starting_tree_type=='pars') %>% select (feature_mds_False_pca_0_3,feature_mds_False_pca_1_3,feature_mds_False_pca_2_3, delta_ll_from_overall_msa_best_topology, is_global_max,feature_msa_pypythia_msa_difficulty)
logistic_model <- glm(is_global_max ~ feature_msa_pypythia_msa_difficulty *feature_mds_False_pca_0_3*feature_mds_False_pca_1_3*feature_mds_False_pca_2_3, 
                      data = data, 
                      family = "binomial")
summary(logistic_model
        )
```



```{r}
features %>% distinct (msa_path, feature_msa_pypythia_msa_difficulty)
all_features %>% distinct(msa_path, feature_msa_pypythia_msa_difficulty)
```

```{r}



all_features %>% group_by(msa_path,starting_tree_ind,starting_tree_type,feature_mds_False_pca_1_3,feature_mds_False_pca_2_3) %>%
filter(msa_path=='/groups/pupko/noaeker/data/New_MSAs/Pandit_msas/PF08033.fasta') 
 
```



```{r}
features %>% distinct (msa_path, feature_msa_pypythia_msa_difficulty)
features %>% group_by(msa_path,starting_tree_ind,starting_tree_type,feature_mds_True_pca_0_3,feature_mds_True_pca_1_3,feature_mds_True_pca_2_3) %>% summarise(is_global_max = max(delta_ll_from_overall_msa_best_topology<=0.1)) %>% filter (starting_tree_type=='rand') %>% filter(msa_path=='/groups/pupko/noaeker/data/New_MSAs/Pandit_msas/PF08021.fasta')  %>% ggplot(aes(x=feature_mds_True_pca_1_3, y = feature_mds_True_pca_2_3, color =as.factor(is_global_max), shape = starting_tree_type))+geom_point()
```
```{r}
features  %>% mutate(is_global_max = max(delta_ll_from_overall_msa_best_topology<=0.1)) %>% ggplot(aes(x=running_time, y = feature_mds_True_pca_2_3, color =as.factor(is_global_max), shape = starting_tree_type))+geom_point()
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

