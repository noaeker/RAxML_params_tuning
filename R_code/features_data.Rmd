---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(tidyverse)
library(survival)
library(survminer)
library(cmprsk)
library(tidyverse)
library(caret)
library(survival)
library(survminer)
library(lubridate)
```



```{r}
all_features<- read_tsv("/Users/noa/Workspace/raxml_deep_learning_results/ready_raw_data/Pandit/MLML_edited_features.tsv")
```

Take a look at the features

```{r}
all_features %>% distinct (msa_path)
```
Parsimony vs. Random behaviour

```{r}
all_features %>% group_by(msa_path,starting_tree_ind,starting_tree_type) %>% summarise(is_global_max = mean(is_global_max)) %>% ggplot(aes(x= is_global_max, color =starting_tree_type))+geom_density()


all_features %>% group_by(msa_path,starting_tree_type, starting_tree_ind) %>% mutate(success = max(is_global_max))%>% ungroup () %>% group_by (msa_path,starting_tree_type) %>% summarise(v_s = var(success)) %>% ggplot(aes(x= v_s, color =starting_tree_type))+geom_density()





```


```{r}
all_features  %>% group_by (msa_path,starting_tree_type,feature_msa_pypythia_msa_difficulty) %>% summarise(is_global_max = max(is_global_max)) %>% pivot_wider(names_from = starting_tree_type, values_from = is_global_max ) %>% mutate (pars_vs_rand = pars-rand) %>% ggplot(aes(y=as.factor(pars_vs_rand), x = feature_msa_pypythia_msa_difficulty))+geom_boxplot()




all_features  %>% group_by (msa_path,starting_tree_type,feature_msa_pypythia_msa_difficulty) %>% summarise(is_global_max = max(is_global_max)) %>% pivot_wider(names_from = starting_tree_type, values_from = is_global_max ) %>% mutate (pars_vs_rand = pars-rand) %>% ggplot(aes(x=(pars_vs_rand)))+geom_histogram()
```

```{r}
all_features %>% group_by(spr_radius, spr_cutoff) %>% summarise(normalized_time = mean(normalized_relative_time), is_global_max = mean(is_global_max)) %>% arrange(normalized_time) %>% ggplot(aes(x=normalized_time, y = is_global_max))+geom_point()+geom_line()
```


MDS feature

```{r}
all_features %>% filter (starting_tree_type=='pars') %>% select (feature_mds_False_pca_0_3_spr_enriched, delta_ll_from_overall_msa_best_topology, is_global_max) %>% ggplot(aes( x =feature_mds_False_pca_0_3_spr_enriched,color=as.factor(is_global_max), ))+geom_density()

all_features %>% filter (starting_tree_type=='pars') %>% select (feature_mds_False_pca_1_3_spr_enriched, delta_ll_from_overall_msa_best_topology, is_global_max) %>% ggplot(aes( x =feature_mds_False_pca_1_3_spr_enriched,color=as.factor(is_global_max), ))+geom_density()


all_features %>% filter (starting_tree_type=='pars') %>% select (feature_mds_False_pca_2_3_spr_enriched, delta_ll_from_overall_msa_best_topology, is_global_max) %>% ggplot(aes( x =feature_mds_False_pca_2_3_spr_enriched,color=as.factor(is_global_max), ))+geom_density()
```
Estimate parsimony tree correlation

```{r}

all_features %>% filter (starting_tree_type=='rand') %>% ggplot(aes(x=normalized_relative_time, color= as.factor(is_global_max)))+ geom_density()

all_features %>% filter (starting_tree_type=='pars') %>% ggplot(aes(x=normalized_relative_time, color= as.factor(is_global_max)))+ geom_density()

```
```{r}
data<-all_features %>% group_by(msa_path) %>% mutate(mds = abs(feature_mds_False_pca_0_3_spr_enriched),delta_ll = delta_ll_from_overall_msa_best_topology/max(delta_ll_from_overall_msa_best_topology))
#data %>% ggplot(aes(x = abs(feature_mds_False_pca_0_3_spr_enriched), y = delta_ll))+geom_point()

cor.test(data$mds, data$delta_ll)

```



Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

